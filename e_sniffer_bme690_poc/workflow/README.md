# Workflow UI

The workflow window stitches together the command-line tools so you can launch data preparation and model training without leaving the desktop app.

## Usage

```bash
python -m workflow.app
```

### Data Preparation Panel

This section wraps `dataprep.build`, which scans collector logs and emits CNN-ready tensors.

- **Logs root** (folder) – the directory that contains your collector CSVs. The prep step searches recursively for files named `bme690_*.csv`. The raw logs remain untouched.
- **Output directory** (folder) – where the prepared artefacts land (`sequences.npz`, `index.csv`, `label_map.json`, `summary.json`). The folder is created if it does not exist.
- **Expected steps (0 = infer)** – optional heater-step count per cycle. Leave it at `0` to let `dataprep` infer the value from the first clean cycle, or set an explicit positive integer to enforce the layout.
- **Drop heater_unstable rows** – when enabled (default), the prep step discards any samples where `heater_heat_stable` was false before grouping cycles. Disable it if you want to keep every logged row.

Click **Run Data Prep** to start the background process. Console output streams into the log pane, and the status label flips to “completed” when tensors are ready. The completion message includes the path to the generated `sequences.npz`.

### Training Panel

Choose between the CNN workflow and the legacy scikit-learn pipeline.

- **Training mode** – pick `CNN (1D conv)` for the new PyTorch trainer or `Legacy (sklearn)` for the classic parquet workflow.
- **Prepared directory / Features parquet** – the label and browse action adapt to the selected mode:
  - CNN mode expects the prepared folder generated by dataprep (`sequences.npz`, `index.csv`, etc.). The UI suggests a fresh destination under `models/cnn_<timestamp>`.
  - Legacy mode accepts a `features.parquet` file produced by the older pipeline.
- **Output directory** – destination for model artefacts. The app requires the folder to be empty (or new) before starting.
- **CNN hyperparameters** – epochs, batch size, learning rate, validation split, and early-stopping patience are available when CNN mode is selected.
- **Legacy hyperparameters** – model choice (`rf`, `logreg`, `gbt`), group column, and number of GroupKFold splits appear when Legacy mode is active.
- **Random seed** applies to either path.

Press **Run Training** to launch the matching CLI (`python -m training_cnn.train ...` or `python -m training.train ...`). Logs stream into the shared pane and the status indicator updates when the subprocess exits.

### General Notes

- Both stages run as `python -m …` subprocesses so the UI stays responsive.
- Prep and train outputs never overwrite existing files; choose a fresh folder for every experiment.
- The log pane keeps a full transcript of the subprocess output for later troubleshooting.
